---
title: 'Season 2017 Analysis'
format: html
execute:
  echo: false
  message: false
  warning: false
---

```{r}
library(tidyverse)
library(plotly)

# 1. Load the data
shots <- read_rds('clean_data.rds')

# 2. Prepare the data
game_summary <- shots |>
  filter(season == 2017) |>
  summarize(
    total_shots = n(),
    avg_xg = mean(xg, na.rm = TRUE),
    total_goals = sum(is_goal, na.rm = TRUE),
    matchup = paste(first(home_team), 'vs', first(away_team)),
    game_label = if('date' %in% names(shots)) as.character(first(date)) else paste('Game ID:', first(game_id)),
    .by = game_id
  )

# 3. Create the ggplot
p <- game_summary |>
  ggplot(aes(x = total_shots, y = avg_xg, color = total_goals)) +
  geom_point(
    aes(
      text = paste0(
        '<b>Matchup:</b> ', matchup, '<br>',
        '<b>Date/ID:</b> ', game_label, '<br>',
        '<b>Total Goals:</b> ', total_goals, '<br>',
        '<b>Shots:</b> ', total_shots, '<br>',
        '<b>Avg xG:</b> ', round(avg_xg, 3)
      )
    ),
    alpha = 0.8,
    size = 3
  ) +
  scale_color_viridis_c(option = 'turbo', name = 'Goals') +
  labs(
    title = 'Game Quantity vs. Quality (2017 Season)',
    x = 'Total Shots in Game',
    y = 'Average xG per Shot'
  ) +
  theme_minimal()

# 4. Render Interactive Plot
ggplotly(p, tooltip = 'text')
```
